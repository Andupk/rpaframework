###################
Robot Framework API
###################

***********
Description
***********

:Library scope: Global

The `Dialogs` library provides a way to ask for user input during executions
through HTML forms. Form elements can be built with library keywords or they can
be defined in a static JSON file.

**How the library works**

The main keyword of the library is ``Request Response`` which works as follows:

1. It starts an HTTP server in the background
2. The HTML form is generated either according to a JSON file or the
   keywords called during the task
3. It opens a browser and shows the created form (The browser is opened with
   the ``Open Available Browser`` keyword from the ``RPA.Browser`` library)
4. Once the form is filled and submitted by the user, the server will process
   the response and extract the field values, which in turn are returned by the keyword
5. In the end, the browser is closed and the HTTP server is stopped

``Request Response`` can be invoked in two ways:

1. Without any parameters. This means that form shown is the one created
   by other library keywords. If no form elements have been added with
   keywords then the form will contain just one submit button. Form building
   must be started with the keyword ``Create Form``.
2. Giving a path to a JSON file (using the parameter **formspec**) which
   specifies the elements that form should include.

The keyword has optional parameters to specify form window **width** and **height**.
The default size is 600px wide and 1000px high.

**Setting library arguments**

Library has arguments ``server_port`` and ``stylesheet``. The ``server_port`` argument
takes integer value, which defines port where HTTP server will be run. By default port is 8105.
The ``stylesheet`` can be used to point CSS file, which will be used to modify style of form,
which is shown to the user. Defaults to built-in Robocorp stylesheet.

**Supported element types**

As a bare minimum, the form is displayed with a submit button when the
``Request Response`` keyword is called.

The supported input elements and their corresponding HTML tags are:

- form (``<form>``)
- title (``<h3>``)
- text (``<p>``)
- radiobutton  (``<input type='radio'>``)
- checkbox (``<input type='checkbox'>``)
- dropdown (``<select>``)
- textarea (``<textarea>``)
- textinput (``<input type='text'>``)
- fileinput (``<input type='file'>``)
- hiddeninput (``<input type='hidden'>``)
- submit (``<input type='submit'>``)

**About file types**

The ``Add File Input`` keyword has parameter ``filetypes``. Parameter sets filter
for file types that can be uploaded via element. Parameter can be set to ``filetypes=${EMPTY}``
to accept all files. Multiple types are separated with comma ``filetypes=image/jpeg,image/png``.

Some common filetypes:

- image/* (all image types)
- audio/* (all audio types)
- video/* (all video types)
- application/pdf (PDFs)
- application/vnd.ms-excel (.xls, .xlsx)

The list of all possible `MIME-types <http://www.iana.org/assignments/media-types/media-types.xhtml>`_.

**Examples**

**Robot Framework**

Examples of creating forms through keywords and a JSON file:

.. code-block:: robotframework

    *** Settings ***
    Library    RPA.Dialogs

    *** Keywords ***
    Ask Question From User By Form Built With Keywords
        Create Form     questions
        Add Text Input  label=What is your name?  name=username
        &{response}=    Request Response
        Log             Username is "${response}[username]"

    Ask Question From User By Form Specified With JSON
        &{response}=    Request Response  /path/to/myform.json
        Log             Username is "${response}[username]"

**Python**

The library can also be used inside Python:

.. code-block:: python

    from RPA.Dialogs import Dialogs

    def ask_question_from_user(question, attribute):
        d = Dialogs()
        d.create_form('questions')
        d.add_text_input(label=question, name=attribute)
        response = request_response()
        return response

    response = ask_question_from_user('What is your name ?', 'username')
    print(f"Username is '{response['username']}'")

********
Keywords
********

:Add Checkbox:
  :Arguments: label: str, element_id: str, options: str, default: str = None

  Add checkbox element


  Example:

  .. code-block:: robotframework

      Create Form
      Add Checkbox    label=Select your colors
      ...             element_id=colors
      ...             options=green,red,blue,yellow
      ...             default=blue

:Add Dropdown:
  :Arguments: label: str, element_id: str, options: typing.Any, default: str = None

  Add dropdown element


  Example:

  .. code-block:: robotframework

      Create Form
      Add Dropdown  label=Select task type
      ...           element_id=tasktype
      ...           options=buy,sell,rent
      ...           default=buy

:Add File Input:
  :Arguments: label: str, element_id: str, name: str, filetypes: str, target_directory: str = None

  Add text input element


  Read more of the filetypes in the library documentation.

  Example:

  .. code-block:: robotframework

      Create Form
      Add File Input  label=Attachment
      ...             element_id=attachment
      ...             name=attachment
      ...             filetypes=${EMPTY}         # Accept all files
      ...             target_directory=${CURDIR}${/}output

      Add File Input  label=Contract
      ...             element_id=contract
      ...             name=contract
      ...             filetypes=application/pdf  # Accept only PDFs
      ...             target_directory=${CURDIR}${/}output

:Add Hidden Input:
  :Arguments: name: str, value: str

  Add hidden input element


  Example:

  .. code-block:: robotframework

      Create Form
      ${uuid}   Evaluate  str(uuid.uuid4())
      Add Hidden Input    form-id   ${uuid}

:Add Radio Buttons:
  :Arguments: element_id: str, options: str, default: str = None

  Add radio button element


  Example:

  .. code-block:: robotframework

      Create Form
      Add Radio Button   element_id=drone  buttons=Jim,Robert  default=Robert

:Add Submit:
  :Arguments: name: str, buttons: str

  Add submit element


  Example:

  .. code-block:: robotframework

      Create Form
      Add Submit    name=direction-to-go  buttons=left,right

:Add Text:
  :Arguments: value: str

  Add text paragraph element


  Example.

  .. code-block:: robotframework

      Create Form
      Add Text       ${form_guidance_text}

:Add Text Input:
  :Arguments: label: str, name: str, value: str = None

  Add text input element


  Example:

  .. code-block:: robotframework

      Create Form
      Add Text Input   what is your firstname ?  fname   value=Mika

:Add Textarea:
  :Arguments: name: str, rows: int = 5, cols: int = 40, default: str = None

  Add textarea element


  Example:

  .. code-block:: robotframework

      Create Form
      Add Textarea       name=feedback  default=enter feedback here
      Add Textarea       name=texts  rows=40   cols=80

:Add Title:
  :Arguments: title: str

  Add h3 element into form


  Example:

  .. code-block:: robotframework

      Create Form     # default form title will be "Requesting response"
      Add Title       User Confirmation Form

:Create Form:
  :Arguments: title: str = None

  Create new form


  Example:

  .. code-block:: robotframework

      Create Form     # form title will be "Requesting response"
      Create Form     title=User Confirmation Form

:Request Response:
  :Arguments: formspec: str = None, window_width: int = 600, window_height: int = 1000

  Start server and show form. Waits for user response.


  Example:

  .. code-block:: robotframework

      Create Form    ${CURDIR}/${/}myform.json
      &{response}    Request Response
